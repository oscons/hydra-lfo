(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.hydralfo = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";var _util=require("./util");Object.defineProperty(exports,"__esModule",{value:!0}),exports.functions=void 0;const _functions={set:{doc:``,fun:a=>{let b=0,c=_util.ud;if("undefined"!=typeof a)if(!Array.isArray(a))"object"!=typeof a&&(b=a);else if(0<a.length){const[d,e]=a;b="object"==typeof d?Array.isArray(d)?0:"v"in d?d.v:0:d,"string"==typeof e&&(c=e)}if("undefined"!=typeof a&&0<a.length&&("object"!=typeof a[0]||Array.isArray(a[0])||"v"in Object.keys(a[0]))){const{v:c}=(0,_util.expand_args)({v:_util.ud},a);b=c}const d=b;return(a,b,e)=>{const f=(0,_util.freeze_values)(d,e,b);return"undefined"!=typeof c&&(b.values[c]=f,c!==b.current_value)?a:f}}},use:{fun:a=>{const{n:b,c:c}=(0,_util.expand_args)({n:"val",c:!1},a);return(a,d,e)=>{const[f,g]=(0,_util.freeze_values)([b,c],e,d);let h=d.values[f];return g&&(h=a),d.current_value=f,h}}},get:{fun:a=>{const{n:b}=(0,_util.expand_args)({n:"val"},a);return(a,c,d)=>{const[e]=(0,_util.freeze_values)([b],d,c),f=c.values[e];return c.current_value=f,f}}},used:{fun:()=>(a,b)=>b.current_value},noop:{fun:()=>a=>a}},functions=_functions;exports.functions=functions;

},{"./util":6}],2:[function(require,module,exports){
"use strict";var _util=require("./util");Object.defineProperty(exports,"__esModule",{value:!0}),exports.functions=void 0;const _functions={},TAU=2*Math.PI;_functions.sin={fun:a=>{const{f:b,s:c,o:d}=(0,_util.expand_args)({f:1,s:1,o:0},a);return(a,e,f)=>{const[g,h,i]=(0,_util.freeze_values)([b,c,d],f,e);let j=0;return j="undefined"==typeof a?(0,_util.get_time)(e,f,!0):a,j=(0,_util.undefault)(j,.25),(Math.sin(j*TAU*g)/2+.5)*h+i}}},_functions.rnd={fun:a=>{const{s:b,o:c,m:d}=(0,_util.expand_args)({s:_util.ud,o:0,m:0},a);return(a,e,f)=>{const[g,h,i]=(0,_util.freeze_values)([b,c,d],f,e);let j=1;return j="undefined"==typeof a?"undefined"==typeof g?1:g:"undefined"==typeof g?a:(0,_util.mix_values)(g,a,i),Math.random()*j+h}}},_functions.rand=_functions.rnd,_functions.range={fun:a=>{const{u:b,l:c,s:d}=(0,_util.expand_args)({u:1,l:0,s:.1},a);return(a,e,f)=>{const[g,h,i]=(0,_util.freeze_values)([b,c,d],f,e);let j=a;"undefined"==typeof j&&(j=(0,_util.get_time)(e,f));let k=g,l=h;if(k<l){const a=l;l=k,k=a}else{if(k===l)return k;if(0===i||0===j)return l}const m=k-l;let n=i*j+l;for(;n<l;)n+=m;for(;n>=k;)n-=m;return n}}},_functions.choose={fun:a=>{const{v:b,s:c}=(0,_util.expand_args)({v:[0,1],s:1},a);return(a,d,e)=>{const[f,g]=(0,_util.freeze_values)([b,c],e,d);if(0===f.length)return 0;let h=(0,_util.undefault)(a,0);h*=g,h=Math.floor(Math.abs(h)),h%=f.length;let i=f[h];const j=`choose_mark_${new Date().getTime()}`;for(let b=10;"function"==typeof i;){const a=i;if(a.__choose_mark=j,i=a(...e,d),0>=b--||"function"==typeof i&&i.__choose_mark===j){i=0;break}delete a.__choose_mark}return i}}};const functions=_functions;exports.functions=functions;

},{"./util":6}],3:[function(require,module,exports){
"use strict";var _util=require("./util");Object.defineProperty(exports,"__esModule",{value:!0}),exports.functions=void 0;const _functions={add:{fun:a=>{const{v:b}=(0,_util.expand_args)({v:0},a);return(a,c,d)=>{const e=(0,_util.freeze_values)(b,d,c);return(0,_util.undefault)(a,0)+e}}},sub:{fun:a=>{const{v:b}=(0,_util.expand_args)({v:0},a);return(a,c,d)=>{const e=(0,_util.freeze_values)(b,d,c);return(0,_util.undefault)(a,0)-e}}},floor:{fun:a=>{const{d:b}=(0,_util.expand_args)({d:0},a);return(a,c,d)=>{const e=(0,_util.freeze_values)(b,d,c),f=Math.pow(10,e);return Math.floor((0,_util.undefault)(a,0)*f)/f}}},mul:{fun:a=>{const{v:b}=(0,_util.expand_args)({v:0},a);return(a,c,d)=>{const e=(0,_util.freeze_values)(b,d,c);return a*e}}},div:{fun:a=>{const{v:b}=(0,_util.expand_args)({v:1},a);return(a,c,d)=>{const e=(0,_util.freeze_values)(b,d,c),f=(0,_util.undefault)(a,0);return 0===e?f/1e-13:f/e}}},mod:{fun:a=>{const{v:b}=(0,_util.expand_args)({v:1},a);return(a,c,d)=>{const e=(0,_util.freeze_values)(b,d,c);return 0===e?0:(0,_util.undefault)(a,0)%e}}}},functions=_functions;exports.functions=functions;

},{"./util":6}],4:[function(require,module,exports){
"use strict";var _util=require("./util");Object.defineProperty(exports,"__esModule",{value:!0}),exports.functions=void 0;const _functions={sah:{fun:a=>{const{h:b}=(0,_util.expand_args)({h:1},a);return(a,c,d)=>{const e=(0,_util.freeze_values)(b,d,c);let f=Number.MIN_SAFE_INTEGER;return"undefined"!=typeof c.private_state.time&&(f=c.private_state.time),"undefined"==typeof c.private_state.value&&(c.private_state.value=a),c.values.time-f>=Math.abs(e)&&(c.private_state.value=a,c.private_state.time=c.values.time),c.private_state.value}}}},DEFAULT_SLEW_TYPE="h",SLEW_TYPES={h:(a,b)=>a-b};_functions.slew={fun:a=>{const{r:b,t:c,i:d}=(0,_util.expand_args)({r:.5,t:DEFAULT_SLEW_TYPE,i:1},a);return(a,e,f)=>{const[g,h]=(0,_util.freeze_values)([b,d],f,e);if("undefined"==typeof e.private_state.time)return e.private_state.time=(0,_util.get_time)(e,f),e.private_state.prev=a,e.private_state.tgt=a,a;const i=(0,_util.undefault)(a,e.private_state.tgt);if("undefined"==typeof i)return _util.ud;"undefined"==typeof e.private_state.prev&&(e.private_state.prev=i);const j=(0,_util.get_time)(e,f),k=j-e.private_state.time,l=i-e.private_state.prev;e.private_state.time=j,e.private_state.tgt=i;const m=l-k/h*g;let n=i;if(0<m){let a=(0,_util.freeze_values)(c,f,e);"string"!=typeof a&&(a=DEFAULT_SLEW_TYPE),a=SLEW_TYPES[a],"undefined"==typeof a&&(a=SLEW_TYPES[DEFAULT_SLEW_TYPE]),n=a(n,m)}return e.private_state.prev=n,n}}},_functions.map={fun:a=>{const{f:b}=(0,_util.expand_args)({f:a=>a},a);return(a,c,d)=>b(a,c,...d)}};const functions=_functions;exports.functions=functions;

},{"./util":6}],5:[function(require,module,exports){
"use strict";var _util=require("./util");Object.defineProperty(exports,"__esModule",{value:!0}),exports.functions=void 0;const _functions={speed:{fun:a=>{const{v:b,m:c}=(0,_util.expand_args)({v:_util.ud,m:_util.ud},a);return(a,d,e)=>{const[f,g]=(0,_util.freeze_values)([b,c],e,d);let h=1;return"undefined"==typeof f?"undefined"!=typeof a&&(h=a):"undefined"==typeof a?h=f:"undefined"==typeof g?h=f:h=(0,_util.mix_values)(f,a,g),d.values.time=h*d.values.time,a}}},fast:{fun:a=>{const{s:b,o:c,m:d}=(0,_util.expand_args)({s:_util.ud,o:0,m:0},a);return(a,e,f)=>{const[g,h,i]=(0,_util.freeze_values)([b,c,d],f,e);let j=1;return"undefined"==typeof a?"undefined"!=typeof g&&(j=g):"undefined"==typeof g?j=a:j=(0,_util.mix_values)(g,a,i),e.values.time=j*e.values.time+h,a}}},time:{fun:a=>{const{s:b,o:c}=(0,_util.expand_args)({s:1,o:0},a);return(a,d,e)=>{const[f,g]=(0,_util.freeze_values)([b,c],e,d);return(0,_util.get_time)(d,e)*f+g}}},beats:{fun:a=>{const{s:b,b:c}=(0,_util.expand_args)({s:1,b:_util.ud},a);return(a,d,e)=>{const[f,g]=(0,_util.freeze_values)([b,c],e,d),{time:h,bpm:i}=e;let j=g;return"undefined"==typeof j&&(j=i),d.values.time=(0,_util.undefault)(h,0)/60*j*f,a}}},sec:{fun:a=>{const{s:b,b:c}=(0,_util.expand_args)({s:1,b:_util.ud},a);return(a,d,e)=>{const[f,g]=(0,_util.freeze_values)([b,c],e,d),h=(0,_util.get_time)(d,e),i=(0,_util.get_bpm)(d,e);let j=g;return"undefined"==typeof j&&(j=i),d.values.time=60*(0,_util.undefault)(h,0)/j*f,a}}}},functions=_functions;exports.functions=functions;

},{"./util":6}],6:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.freeze_values=exports.get_bpm=exports.get_time=exports.expand_args=exports.undefault=exports.mix_values=exports.CANARY=exports.ud=void 0;const ud=function(){}();exports.ud=ud;const CANARY="__hydralfo_func";exports.CANARY="__hydralfo_func";const mix_values=(c,a,b)=>0===b?c:1===b?a:c*(1-b)+a*b;exports.mix_values=mix_values;const undefault=(a,b)=>"undefined"==typeof a?b:a;exports.undefault=undefault;const expand_args=(a,b)=>{const c={...undefault(a,{})};if("undefined"!=typeof b&&0<b.length){const[d]=b;if("object"==typeof d&&!Array.isArray(d))for(const b in a)b in d&&(c[b]=d[b]);else{let d=Object.keys(a);d=d.slice(0,Math.min(d.length,b.length)),d.forEach((a,d)=>{c[a]=b[d]})}}return Object.keys(c).forEach(b=>{const d=c[b],e=a[b];c[b]="function"==typeof d?(a,b,c)=>{let f=c;if("undefined"==typeof f&&(f=[{}]),CANARY in d){const a=[];return f.forEach(b=>{"object"==typeof b?Array.isArray(b)?a.push([...b]):"call"in b?a.push(b):a.push({...b}):a.push(b)}),undefault(d.run(a),e)}return undefault(d(a,b,f),e)}:"undefined"==typeof d?()=>e:()=>d}),c};exports.expand_args=expand_args;const get_time=(a,b,c=!1)=>{let d=b;if(Array.isArray(d)&&0<d.length&&([d]=d),"object"==typeof d&&!Array.isArray(d)){const{time:a}=d;if("undefined"!=typeof a)return a}return"undefined"!=typeof a&&"undefined"!=typeof a.values&&"undefined"!=typeof a.values.time?a.values.time:"undefined"!=typeof window&&"undefined"!=typeof window.time?window.time:c?ud:new Date().getTime()/1e3};exports.get_time=get_time;const get_bpm=(a,b,c=!1)=>{let d=b;if(Array.isArray(d)&&0<d.length&&([d]=d),"object"==typeof d&&!Array.isArray(d)){const{bpm:a}=d;if("undefined"!=typeof a)return a}return"undefined"!=typeof a&&"undefined"!=typeof a.values&&"undefined"!==a.values.bpm?a.values.bpm:c?ud:60};exports.get_bpm=get_bpm;const freeze_values=(a,b,c)=>"undefined"==typeof a?a:"function"==typeof a?a(...b,c):Array.isArray(a)?a.map(a=>freeze_values(a,b,c)):a;exports.freeze_values=freeze_values;

},{}],7:[function(require,module,exports){
(function (global){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=exports.get_doc=void 0;var _util=require("./components/util"),_maths=require("./components/maths"),_generators=require("./components/generators"),_time=require("./components/time"),_general=require("./components/general"),_modifiers=require("./components/modifiers");const BUILTIN_FUNCTIONS=[_maths.functions,_generators.functions,_time.functions,_general.functions,_modifiers.functions].reduce((a,b)=>(Object.entries(b).forEach(([b,c])=>{a[b]=c}),a),{}),extract_property=(a,b)=>Object.entries(a).map(([a,c])=>[a,c[b]]).reduce((a,[b,c])=>(a[b]=c,a),{}),get_doc=()=>Object.entries(extract_property(BUILTIN_FUNCTIONS,"doc")).filter(([,a])=>"undefined"!=typeof a).reduce((a,[b,c])=>([a[b]]=c,a),{});exports.get_doc=get_doc;const run_calls=(a,b,c,d,e)=>{const f={...{return_undef:!1,init_val_time:!0},...a};let g=e;("undefined"==typeof g||0===g.length)&&(g=[{}]),"undefined"==typeof g[0]&&(g[0]={});const h={input:_util.ud,current_value:"val",values:{val:_util.ud,initial_args:e,...g[0]},global_state:b,instance_state:c,private_state:{}};h.values.initial_time=(0,_util.get_time)(h.values,g),h.values.time=h.values.initial_time,f.init_val_time&&(h.values.val=h.values.time),h.values.get_bpm=(0,_util.get_bpm)(h.values,h.values),g[0]=h.values,d.forEach(([a,b])=>{h.private_state=b,h.input=h.values[h.current_value];const c=a(h.input,h,g);h.values[h.current_value]=c});const i=h.values[h.current_value];return"undefined"!=typeof i||f.return_undef?i:0},sub_call=(a,b,c)=>{const d=b.map(a=>[a,{}]),e={};"undefined"!=typeof c&&d.push([c,{}]);const f=(b,c)=>run_calls(b,a,e,d,c),g=(...a)=>f({},a);return g.run=g,g.gen=a=>(...b)=>f(a,b),g[_util.CANARY]=!0,Object.entries(extract_property(BUILTIN_FUNCTIONS,"fun")).forEach(([b,c])=>{if(b in g&&!(b in Object.getOwnPropertyNames()))throw new Error(`${b} already exists on parents of run_function`);g[b]=(...b)=>sub_call(a,d.map(([a])=>a),c(b))}),g},get_global_env=()=>"undefined"==typeof window?global:window,make_new_lfo=a=>{const b={},c="undefined"==typeof a?{}:a,d=extract_property(BUILTIN_FUNCTIONS,"fun");return Object.keys(d).forEach(a=>{b[a]=(...b)=>sub_call(c,[])[a](...b)}),b.__release=()=>{},b},GLOBAL_INIT_ID="__hydralfo_global",init=(a=_util.ud,b=!0,c=!1)=>{const d=make_new_lfo(a);if(!b)return d;const e=get_global_env();if("undefined"!=typeof e){if(GLOBAL_INIT_ID in e){const a=e[GLOBAL_INIT_ID];if("object"==typeof a){if(!c)return e[GLOBAL_INIT_ID];"__release"in a&&a.__release(d)}}e[GLOBAL_INIT_ID]=d}return d};exports.init=init;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./components/general":1,"./components/generators":2,"./components/maths":3,"./components/modifiers":4,"./components/time":5,"./components/util":6}]},{},[7])(7)
});
//# sourceMappingURL=hydralfo.min.js.map
